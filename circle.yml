general:
  artifacts:
    - "/home/ubuntu/build/Visitry/android/debug.apk"
    - "/home/ubuntu/build/Visitry/android/release-unsigned.apk"
    - "/home/ubuntu/build/Visitry/bundle.tar.gz"
    - "/home/ubuntu/build/Visitry/mobile/android/Visitry.apk"
dependencies:
  cache_directories:
    - ~/.meteor
  override:
    - meteor || curl https://install.meteor.com | /bin/sh
    - npm -g install spacejam@rc
    - meteor npm install
  pre:
    - npm -g install ssh2
    - npm install -g mup # install meteor-up for deployment
    - mkdir $HOME/build/
    - mkdir $HOME/build/Visitry/
deployment:
  dev:
    branch: dev
    commands:
      - cd $HOME/Visitry/.deploy/dev && mup deploy
      - meteor build $HOME/build/Visitry/mobile --server https://dev.visitry.org
      - sh $HOME/Visitry/.deploy/staging/android-sign-apk.sh
  staging:
    branch: master
    commands:
      - aws s3 cp s3://visitry-build-info/push-notifications/VisitryPushProd.pem $HOME/Visitry/private/VisitryPushProd.pem
      - aws s3 cp s3://visitry-build-info/push-notifications/PushKey1216.pem $HOME/Visitry/private/PushKey1216.pem
      - cd $HOME/Visitry/.deploy/staging && mup deploy
      - meteor build $HOME/build/Visitry/mobile --server https://test.visitry.org
      - sh $HOME/Visitry/.deploy/staging/android-sign-apk.sh
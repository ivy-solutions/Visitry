<ion-view view-title="Requests" hide-back-button=true>
  <ion-nav-buttons side="secondary" class="show">
    <button class="button button-clear icon ion-plus-circled" ng-click="pendingVisits.showRequestVisitModal()">
    </button>
  </ion-nav-buttons>
  <ion-content class="has-header has-tabs">
      <div class="warning" ng-hide="connectionStatus=='ok'">
          No connection to server. ({{connectionStatus}})
      </div>
    <div class="emptyListInfo" ng-hide="pendingVisits.numRequests>0">
      No active requests. Press + to request a visit.
    </div>
    <ion-list show-delete="pendingVisits.showDelete" can-swipe="pendingVisits.canSwipe">
      <div ng-repeat="dateVisits in pendingVisits.pendingVisits">
        <div class="item item-divider">
          {{dateVisits.date|date: "EEEE, MMMM d"}}
        </div>
        <ion-item ng-repeat="visit in dateVisits.visits" class="item-avatar"
                  on-swipe-left="pendingVisits.showCancelVisitConfirm(visit)">
            <img ng-if="visit.visitorId" ng-src="{{pendingVisits.getVisitorImage(visit)}}" ng-click="pendingVisits.visitDetails(visit._id)">
            <div ng-if="!visit.visitorId" class="visit-picture no-visitor" ng-click="pendingVisits.visitDetails(visit._id)"></div>
            <a ng-click="pendingVisits.visitDetails(visit._id)">
              <div>
                <h4 ng-if="!visit.visitorId" class="requestedTime">Requested <span class="timeAgo">{{pendingVisits.getTimeSinceRequested(visit.createdAt)}}</span>
                </h4>
                <h2 ng-if="visit.visitorId">
                    <span class="time">{{visit.visitTime | date:'h:mm'}}</span>
                    {{pendingVisits.getVisitor(visit) | firstNameLastInitial }}
                </h2>
                <span flex></span>
              </div>
              <p>{{visit.notes}}</p>
            </a>
              <ion-option-button class="button-assertive" ng-click="pendingVisits.showCancelVisitConfirm(visit)">
                Cancel Visit
              </ion-option-button>
        </ion-item>
      </div>
    </ion-list>
  </ion-content>
</ion-view>
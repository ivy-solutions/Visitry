<ion-view title="Join" hide-tabs>
    <ion-nav-buttons side="right">
        <button ng-click="agencies.profile()" ng-if="agencies.registering()" class="button button-clear button-icon icon-right ion-ios-arrow-right" style="font-weight: 400;">
            Profile&nbsp;
        </button>
    </ion-nav-buttons>
    <ion-content>
        <ion-list can-swipe="agencies.canSwipe">
            <div ng-repeat="agency in agencies.agencies">
            <ion-item>
                <a ng-click="agencies.agencyDetail(agency._id)">
                    <h2>
                        <i class="ion-checkmark-circled" ng-if="!agencies.isNotMember(agency._id)"
                           ng-class="{calm: agencies.isMember(agency._id), energized:agencies.isPendingMember(agency._id)}" ></i>
                        {{agency.name}}{{agencies.membershipStatus}}
                    </h2>
                    <div class="item-text-wrap"><h3>{{agency.description}}</h3></div>
                </a>
                <p>{{agency.location.formattedAddress}}</p>
                <ion-item-options side="right">
                    <ion-option-button class="button-dark" ng-click="agencies.agencyDetail(agency._id)">
                        Details
                    </ion-option-button>
                    <ion-option-button class="button-assertive" ng-if="agencies.isPendingMember(agency._id)" ng-click="agencies.revokeRequest(agency._id)">
                        Remove Request
                    </ion-option-button>
                    <ion-option-button class="button-positive" ng-if="agencies.isNotMember(agency._id)" ng-click="agencies.requestMembership(agency._id)">
                        Ask to Join
                    </ion-option-button>
                </ion-item-options>
            </ion-item>
            </div>
        </ion-list>
    </ion-content>
</ion-view>